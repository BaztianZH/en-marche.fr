{% extends 'referent/_layout.html.twig' %}

{% block referent_content %}
    {{ include('referent/territorial_council/_instances_nav.html.twig') }}

    <main>
        <section class="b__nudge--bottom-huge">
            <div class="datagrid__pre-table b__nudge--bottom">
                {% if total_count %}
                    <span class="datagrid__count">
                        <span>{{ memberships.totalItems|number_format(0, ',', ' ') }}</span> sur {{ total_count|number_format(0, ',', ' ') }} membre{{ total_count > 1 ? 's' : '' }}
                    </span>
                {% endif %}
            </div>

            <div class="datagrid">
                <div class="b__nudge--bottom-larger">
                    <div class="datagrid__table-container">
                        <table class="datagrid__table-manager">
                            <thead>
                            <tr>
                                {% set order = filter.order and filter.order == 'd' ? 'a' : 'd' %}

                                <th style="width: 150px;">
                                    <a
                                            href="{{ path("app_referent_territorial_council_members_list", {f: filter.toArray()|merge({sort: 'lastName', order: order})}) }}"
                                            class="sort-link sort-link--order-{{ filter.sort == 'lastName' ? filter.order : 'a' }}"
                                    >
                                        Identité
                                    </a>
                                </th>
                                <th style="min-width: 180px;">Qualités</th>
                                <th style="width: 100px;">Membre depuis le</th>
                                <th style="width: 130px;">Téléphone</th>
                                <th style="width: 70px;">SMS/MMS</th>
                                <th style="width: 120px;">Statut (é-mail)</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for key, membership in memberships %}
                                {% set adherent = membership.adherent %}
                                <tr class="referent__item">
                                    <td class="adherent-identity">
                                        <div class="adherent-name">
                                            {{ adherent.lastName }} {{ adherent.firstName }}
                                        </div>
                                        <div class="adherent-caracs">
                                            {{ adherent.gender ? ('male' == adherent.gender ? 'common.gender.man' : 'common.gender.woman')|trans : '~' }},
                                            {{ adherent.age ? adherent.age ~ ' ans' : '~'}}
                                        </div>
                                    </td>
                                    <td>
                                        {% for quality in membership.qualities %}
                                            <b>{{ ('territorial_council.membership.quality.' ~ quality.name)|trans }}</b> {{ quality.zone }}<br />
                                        {% endfor %}
                                    </td>
                                    <td>
                                        {{ membership.joinedAt|date('d/m/Y') }}
                                    </td>
                                    <td>
                                        {% if adherent.phone %}
                                            {{ adherent.phone|phone_number_format }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% set hasSmsSubscriptionType = adherent.hasSmsSubscriptionType %}
                                        <span class="status status__{{ hasSmsSubscriptionType ? '1' : '2' }}">
                                            {{ (hasSmsSubscriptionType ? 'global.yes' : 'global.no')|trans }}
                                        </span>
                                    </td>
                                    <td>
                                        {% set is_email_subscribed = filter.subscriptionType and filter.subscriptionType in adherent.subscriptionTypes %}
                                        <span class="status status__{{ is_email_subscribed ? '1' : '2' }}">
                                            {{ (is_email_subscribed ? 'common.adherent.subscribed' : 'common.adherent.unsubscribed')|trans }}
                                        </span>
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text--center">
                                        <img src="{{ asset('/images/icons/icn_no-result.svg') }}" class="icn--no-result" width="30" />
                                        Aucun résultat
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                {% if memberships.count %}
                    {% include 'components/_modern_pagination.html.twig' with {
                        current_page: memberships.currentPage,
                        total_pages: memberships.lastPage,
                        pagination_route_params: {f: filter.toArray()},
                    } %}
                {% endif %}
            </div>
        </section>
    </main>
{% endblock %}
