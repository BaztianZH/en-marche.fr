{% set has_role_adherent = is_granted('ROLE_ADHERENT') %}

<nav class="gtm__navigation__desktop l__wrapper l__row l__row--h-stretch l__hide--on-tablet {{ app.user ? '' : 'space--20-0' }}">
    <ul class="list__links list__links--row list__links--nav list__links--no-decor">
        <li>
            <a href="{{ path('homepage') }}" class="text--logo b__nudge--right-0">EM!</a>
        </li>
        <div class="l__row">
            <div class="nav-dropdown">
                <p>
                    Le Mouvement
                    <img alt="menu" class="nav__chevron" src="{{ asset('/images/icons/chevron-down-light-black.svg') }}">
                </p>
                <ul class="nav-dropdown__item">
                    <li>
                        <a href="{{ path('page_le_mouvement') }}">Qui sommes-nous ?</a>
                    </li>
                    <li>
                        <a href="{{ path('app_our_organization') }}">Notre organisation</a>
                    </li>
                    <li>
                        <a href="https://en-marche.fr/le-mouvement/fonctionnement">Notre fonctionnement</a>
                    </li>
                    <li>
                        <a href="{{ path('our_referents_homepage') }}">Nos r√©f√©rents</a>
                    </li>
                    <li>
                        <a href="https://dpt.en-marche.fr" rel="noopener noreferrer" target="_blank">
                            Nos sites d√©partementaux
                        </a>
                    </li>
                    <li>
                        <a href="{{ path('legislatives_homepage') }}">
                            Nos d√©put√©s
                        </a>
                    </li>
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'nos-senateurs' }) }}">Nos s√©nateurs</a>
                    </li>
                </ul>
            </div>
        </div>
        <li>
            <a href="{{ path('articles_list', { category: 'tout' }) }}">Actualit√©s</a>
        </li>
        <div class="l__row">
            <div class="nav-dropdown">
                <p>
                    √âlections
                    <img alt="menu" class="nav__chevron" src="{{ asset('/images/icons/chevron-down-light-black.svg') }}">
                </p>
                <ul class="nav-dropdown__item">
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'municipales' }) }}">Municipales 2020</a>
                    </li>
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'consulaires2021' }) }}">Consulaires 2021</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="l__row">
            <div class="nav-dropdown nav-dropdown__mrg--0">
                <p>
                    S'engager
                    <img alt="menu" class="nav__chevron" src="{{ asset('/images/icons/chevron-down-light-black.svg') }}">
                </p>
                <ul class="nav-dropdown__item">
                    <li>
                        <a href="{{ path('app_search_events') }}">√âv√©nements</a>
                    </li>
                    <li>
                        <a href="{{ path('app_search_committees') }}">Comit√©s</a>
                    </li>
                    <li>
                        <a href="{{ path('react_app_citizen_projects_home') }}">Projets citoyens</a>
                    </li>
                    <li>
                        <a href="{{ path('react_app_ideas_workshop_home') }}">Atelier des id√©es</a>
                    </li>
                    <li>
                        <a href="{{ mooc_host }}">Formation</a>
                    </li>
                    <li>
                        <a href="{{ mooc_host }}/sengager-a-la-republique-en-marche">S'engager √† LaREM</a>
                    </li>
                    <li>
                        <a href="{{ path('page_le_mouvement_devenez_benevole') }}">Devenez b√©n√©vole</a>
                    </li>
                    <li>
                        <a href="{{ path('donation_index') }}">Faire un don</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="l__row">
            <div class="nav-dropdown">
                <p>
                    Nos id√©es
                    <img alt="menu" class="nav__chevron" src="{{ asset('/images/icons/chevron-down-light-black.svg') }}">
                </p>
                <ul class="nav-dropdown__item">
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'notre-projet' }) }}">Notre projet</a>
                    </li>
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'nos-resultats' }) }}">Nos r√©sultats concrets</a>
                    </li>
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'conferences-debats' }) }}">Les conf√©rences-d√©bats</a>
                    </li>
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'publications' }) }}">Les publications</a>
                    </li>
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'vos-contributions' }) }}">Vos contributions</a>
                    </li>
                    <li>
                        <a href="{{ path('app_static_page', { slug: 'apres-la-crise' }) }}">Reconstruire Ensemble</a>
                    </li>
                </ul>
            </div>
        </div>
        <li {% if not algolia_app_id or not algolia_api_key %} style="display: none;" {% endif %} class="b__nudge--left-medium">
            <a class="je-cherche" href="javascript:void(0)">
                {{ include('components/search.html.twig') }}
            </a>
        </li>
    </ul>
    <div class="l__row">
        <div class="nav-dropdown">
            {% if is_granted('ROLE_ADMIN_DASHBOARD') %}
                <div class="space--20-0">
                    <a href="{{ path('sonata_admin_dashboard') }}" class="nav-dropdown__name link--no--decor">
                        Admin ü§ì
                    </a>
                </div>
            {% else %}
                {% if app.user %}
                    <a href="{{ has_role_adherent ? path('app_user_profile') }}" class="icon--with-text nav-dropdown__name">
                        {{ include('components/user.html.twig') }}
                        {{ app.user.firstName is defined ? app.user.firstName : ''}}
                        {% if is_certified %}
                            {% include('components/_certification_logo.html.twig') %}
                        {% endif %}
                    </a>
                {% endif %}
                {% if has_role_user %}
                    <div class="nav-dropdown__caret">
                        <span class="nav-dropdown__caret--outer"></span>
                        <span class="nav-dropdown__caret--inner"></span>
                    </div>
                    <div class="nav-dropdown__menu">
                        <ul class="nav-dropdown__section">
                            <li class="nav-dropdown__section__name">
                                <a href="{{ has_role_adherent ? path('app_user_profile') }}" class="icon--with-text">
                                    <div>{{ app.user }}</div>
                                    <div class="text--small text--gray text--normal">{{ get_adherent_role_labels(app.user)|join(', ') }}</div>
                                </a>
                            </li>
                        </ul>
                        <div class="nav-dropdown__separator"></div>
                        <div class="nav-dropdown__row">
                            <div>
                                {% if has_role_adherent %}
                                    <ul class="nav-dropdown__section">
                                        <li>
                                            <a href="{{ path('app_summary_manager_index') }}">Profil</a>
                                        </li>
                                        <li>
                                            <a href="{{ path('app_adherent_events', {type: 'upcoming'}) }}">Mes activit√©s</a>
                                        </li>
                                        <li>
                                            <a href="{{ path('app_user_profile_donation') }}">Mes dons</a>
                                        </li>
                                        {% if app.user and (has_role_adherent or app.user.isHost) %}
                                            <li>
                                                <a href="{{ path('app_documents_index') }}">Mes documents</a>
                                            </li>
                                        {% endif %}
                                        {% if is_granted('ROLE_FORMATION_SPACE') %}
                                            <li class="visually-hidden">
                                                <a href="{{ path('app_formation_home') }}" class="is-new">Je me forme</a>
                                            </li>
                                        {% endif %}
                                    </ul>

                                    <div class="nav-dropdown__separator"></div>
                                    {% if has_role_adherent and is_granted('CREATE_COMMITTEE') %}
                                        <ul class="nav-dropdown__section">
                                            <li>
                                                <a href="{{ path('app_adherent_create_committee') }}">Cr√©er un comit√©</a>
                                            </li>
                                        </ul>
                                        <div class="nav-dropdown__separator"></div>
                                    {% endif %}
                                {% endif %}
                                {% if app.user and not has_role_adherent %}
                                    <div class="nav-dropdown__separator"></div>
                                    <ul class="nav-dropdown__section">
                                        <li>
                                            <a href="{{ path('app_membership_join') }}">Adh√©rer</a>
                                        </li>
                                    </ul>
                                {% endif %}
                                <ul class="nav-dropdown__section">
                                    <li>
                                        <a class="text--gray" href="{{ path('app_user_set_email_notifications') }}">Mes communications via e-mail et mobile</a>
                                    </li>
                                    <li>
                                        <a class="text--gray" href="{{ path('app_user_profile') }}">Param√®tres</a>
                                    </li>
                                    <li>
                                        <a class="text--gray" href="https://aide.en-marche.fr" rel="noopener noreferrer" target="_blank">Aide</a>
                                    </li>
                                    <li>
                                        <a class="text--gray" href="{{ path('logout') }}">D√©connexion</a>
                                    </li>
                                    {% if is_granted('ROLE_PREVIOUS_ADMIN') %}
                                        <li class="text--small">
                                            <a href="{{ path('app_admin_impersonation_exit') }}">
                                                Quitter l'impersonnification
                                            </a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </div>
                            {% if has_role_adherent %}
                                <ul class="nav-dropdown__section">
                                    <li class="text--small text--bold">Comit√©s</li>
                                    <li>
                                        {{ adherent_committees }}
                                    </li>
                                </ul>
                                <ul class="nav-dropdown__section">
                                    <li class="text--small text--bold">Projets citoyens</li>
                                    <li>
                                        {{ adherent_citizen_projects }}
                                    </li>
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        </div>
        {% if not app.user %}
            <a href="{{ path('app_user_login') }}" class="text--body link--no-decor b__nudge--right">Connexion</a>
        {% endif %}
        {% if not has_role_adherent %}
            <a href="{{ path('app_membership_join') }}" class="text--body b__nudge--right">Adh√©rer</a>
        {% endif %}
        <a href="{{ path('donation_index') }}" class="btn btn--red">Donner</a>
    </div>

    {% if has_role_user %}
        <div class="em-nav em-nav-dropdown">
            <div class="l__wrapper">
                <div class="l__row l__row--top">
                    <div class="em-nav-dropdown__col">
                        <div class="adherent-profile__id l__row b__nudge--bottom">
                            <div class="name b__nudge--right-nano">{{ app.user.partialName }}</div>
                            {% if is_certified %}
                                <div class="l__row">
                                    {% include('components/_certification_logo.html.twig') %}
                                </div>
                            {% endif %}
                        </div>
                        <ul class="adherent-profile__roles b__nudge--bottom">
                            {% for role in get_adherent_role_labels(app.user) %}
                                <li>{{ role }}</li>
                            {% endfor %}
                        </ul>
                        <div class="adherent-profile__completion b__nudge--bottom">
                            <div class="text--body text--small b__nudge--bottom-small">
                                <!-- If is not completed -->
                                Compl√©tion du profil : 50%
                                <!-- If is completed TODO
                                üëè Profil compl√©t√© ! -->
                            </div>
                            <div class="gauge">
                                <span></span>
                            </div>
                            <div class="b__nudge--top-10">
                                <a href="#" class="text--body text--small text--blue--dark link--no-decor">Compl√©ter mon profil</a>
                            </div>
                        </div>
                        <ul class="">
                            <li class="space--5-0"><a href="" class="text--body text--small link--no-decor">Formation</a></li>
                            <li class="space--5-0"><a href="" class="text--body text--small link--no-decor">Aide</a></li>
                            <li class="space--5-0"><a href="" class="text--body text--small link--no-decor">D√©connexion</a></li>
                        </ul>
                    </div>
                    <div class="em-nav-dropdown__col">
                        <div class="em-nav__menu em-nav__menu--dropdown">
                            <span class="head">Informations</span>
                            <ul class="items">
                                <li><a href="#">G√©n√©ral</a></li>
                                <li><a href="#">Certification du profil</a></li>
                                <li><a href="#">E-mail et mot de passe</a></li>
                                <li><a href="#">Centres d'int√©ret</a></li>
                                <li><a href="#">Engagement</a></li>
                                <li><a href="#">√âlections</a></li>
                                <li><a href="#">Communication</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="em-nav-dropdown__col">
                        <div class="em-nav__menu em-nav__menu--dropdown">
                            <span class="head">Activit√©s</span>
                            <ul class="items">
                                <li><a href="#">Mes comit√©s</a></li>
                                <li><a href="#">Mes √©v√©nements</a></li>
                                <li><a href="#">Mes projets citoyens</a></li>
                                <li><a href="#">Mon atelier des id√©es</a></li>
                                <li><a href="#">Mes dons</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="em-nav-dropdown__col">
                        <div class="em-nav__menu em-nav__menu--dropdown">
                            <span class="head">Documents</span>
                            <ul class="items">
                                <li><a href="#">Mes documents</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

</nav>
{% if is_granted('ROLE_SUPERVISOR') or
    is_granted('ROLE_HOST') or
    is_granted('ROLE_CITIZEN_PROJECT_ADMINISTRATOR') or
    is_granted('ROLE_REFERENT') or
    is_granted('ROLE_COREFERENT') or
    is_granted('ROLE_DEPUTY') or
    is_granted('ROLE_SENATOR') or
    is_granted('ROLE_BOARD_MEMBER') or
    is_granted('ROLE_COORDINATOR') or
    is_granted('ROLE_PROCURATION_MANAGER') or
    is_granted('ROLE_LEGISLATIVE_CANDIDATE') or
    is_granted('ROLE_ASSESSOR_MANAGER') or
    is_granted('ROLE_MUNICIPAL_CHIEF') or
    is_granted('ROLE_JECOUTE_MANAGER') or
    is_granted('ROLE_ASSESSOR') or
    is_granted('ROLE_ELECTION_RESULTS_REPORTER') or
    is_granted('ROLE_MUNICIPAL_MANAGER') or
    is_granted('ROLE_MUNICIPAL_MANAGER_SUPERVISOR') or
    is_granted('ROLE_SENATORIAL_CANDIDATE') or
    is_granted('ROLE_DELEGATED_REFERENT') or
    is_granted('ROLE_DELEGATED_DEPUTY') or
    is_granted('ROLE_DELEGATED_SENATOR')
%}
    {% set totalSections =
        (app.user.isSupervisor or app.user.isHost) +
        (app.user.isReferent or app.user.isCoReferent) +
        app.user.isDeputy +
        app.user.isSenator +
        app.user.isCoordinatorCitizenProjectSector +
        app.user.isCoordinatorCommitteeSector +
        app.user.isProcurationManager +
        app.user.isAssessorManager +
        app.user.isMunicipalChief +
        app.user.isJecouteManager +
        app.user.isMunicipalManagerSupervisor +
        app.user.isAssessor +
        app.user.isMunicipalManager +
        app.user.isElectionResultsReporter +
        app.user.isSenatorialCandidate +
        is_granted('ROLE_CITIZEN_PROJECT_ADMINISTRATOR') +
        is_granted('ROLE_DELEGATED_REFERENT') +
        is_granted('ROLE_DELEGATED_DEPUTY') +
        is_granted('ROLE_DELEGATED_SENATOR')
    %}

    <div class="background--darker l__hide--on-tablet">
        <ul class="l__wrapper space--10-0 list__links list__links--row list__links--row-left list__links--no-decor list__links--subnav nav-dropdown__menu__items">
            {% if totalSections > 1 %}
            <li>
                <div class="nav-dropdown" style="margin: 0;">
                    <a href="#">Mes espaces</a>
                    <i class="fa fa-caret-down" aria-hidden="true"></i>
                    <i class="fa fa-caret-up" aria-hidden="true"></i>
                    <div class="nav-dropdown__menu nav-dropdown__black">
                        <ul class="list__links">
                            {{ include('adherent/_list_my_sections.html.twig') }}
                        </ul>
                    </div>
                </div>
            </li>
            {% else %}
                {{ include('adherent/_list_my_sections.html.twig') }}
            {% endif %}
            {% if is_granted('ROLE_FORMATION_SPACE') %}
                <li>
                    <a href="{{ path('app_formation_home') }}" class="is-new">Je me forme</a>
                </li>
            {% endif %}
        </ul>
    </div>
{% endif %}
